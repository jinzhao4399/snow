<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>立冬祝福 · 雪花飘落</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      -webkit-tap-highlight-color: transparent;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC',
        'Noto Sans CJK SC', 'Microsoft YaHei', sans-serif;
    }
    .stage {
      position: fixed;
      inset: 0;
      overflow: hidden;
      background: radial-gradient(ellipse at center, #000 0%, #000 60%, #000 100%);
    }
    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    .content {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      line-height: 1.7;
      padding: 0 24px;
      max-width: 90vw;
      text-shadow: 0 0 6px rgba(255,255,255,0.3);
      user-select: none;
    }
    .btn {
      position: absolute;
      left: 50%;
      bottom: env(safe-area-inset-bottom, 16px);
      transform: translateX(-50%);
      background: rgba(255,255,255,0.08);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.25);
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 14px;
      backdrop-filter: blur(6px);
    }
    .hint {
      position: absolute;
      left: 0;
      right: 0;
      bottom: calc(env(safe-area-inset-bottom, 16px) + 56px);
      text-align: center;
      font-size: 12px;
      color: rgba(255,255,255,0.6);
    }
  </style>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />
</head>
<body>
  <div class="stage" role="application" aria-label="雪花飘落祝福">
    <canvas id="snow"></canvas>
    <div id="content" class="content"></div>
    <div class="hint">轻触屏幕 暂停/继续</div>
    <button id="fullscreenBtn" class="btn" type="button">全屏观看</button>
  </div>

  <script>
    // ===== Utils: read message from ?text= or #text= =====
    function getMessageFromURL() {
      const search = new URLSearchParams(location.search);
      let msg = search.get('text');
      if (!msg && location.hash) {
        const hash = new URLSearchParams(location.hash.slice(1));
        msg = hash.get('text') || decodeURIComponent(location.hash.slice(1));
      }
      if (!msg) {
        msg = [
          '立冬的第一条祝福',
          '我想对你说',
          '愿这个冬季',
          '没有风霜雨雪',
          '只有阳光明媚',
          '愿过去的不愉快都过去',
          '即将到来的都是美好事物',
          '愿你往后一切安好'
        ].join('\n');
      }
      try { return decodeURIComponent(msg); } catch { return msg; }
    }

    // ===== Render content =====
    const contentEl = document.getElementById('content');
    function renderMessage(text) {
      const lines = String(text).split(/\n|\\n/g).filter(Boolean);
      contentEl.innerHTML = lines.map(l => `<div>${l.replace(/</g,'&lt;')}</div>`).join('');
    }
    renderMessage(getMessageFromURL());

    // ===== Snow animation =====
    const canvas = document.getElementById('snow');
    const ctx = canvas.getContext('2d');
    let width = 0, height = 0, dpr = Math.min(2, window.devicePixelRatio || 1);
    let flakes = [];
    let playing = true;

    function resize() {
      width = canvas.clientWidth = window.innerWidth;
      height = canvas.clientHeight = window.innerHeight;
      canvas.width = Math.floor(width * dpr);
      canvas.height = Math.floor(height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function createFlake() {
      return {
        x: Math.random() * width,
        y: -10 - Math.random() * height,
        r: 0.5 + Math.random() * 2.6,
        speedY: 0.6 + Math.random() * 1.8,
        speedX: -0.6 + Math.random() * 1.2,
        swing: Math.random() * Math.PI * 2
      };
    }

    function ensureFlakeCount() {
      const target = Math.round(Math.max(120, width * height / 12000));
      while (flakes.length < target) flakes.push(createFlake());
      if (flakes.length > target) flakes.length = target;
    }

    function tick() {
      if (!playing) return requestAnimationFrame(tick);
      ctx.clearRect(0, 0, width, height);
      ensureFlakeCount();
      for (let i = 0; i < flakes.length; i++) {
        const f = flakes[i];
        f.y += f.speedY;
        f.x += f.speedX + Math.cos(f.swing += 0.02) * 0.2;
        if (f.y > height + 6) {
          flakes[i] = createFlake();
          flakes[i].y = -6;
        }
        if (f.x < -6) f.x = width + 6;
        if (f.x > width + 6) f.x = -6;
        ctx.globalAlpha = 0.7 + Math.sin(f.swing) * 0.3;
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
        ctx.fill();
      }
      requestAnimationFrame(tick);
    }

    // events
    window.addEventListener('resize', resize, { passive: true });
    resize();
    requestAnimationFrame(tick);

    // tap to pause/resume
    document.body.addEventListener('click', () => { playing = !playing; if (playing) requestAnimationFrame(tick); });

    // fullscreen
    const fsBtn = document.getElementById('fullscreenBtn');
    fsBtn.addEventListener('click', async () => {
      const elem = document.documentElement;
      if (!document.fullscreenElement && elem.requestFullscreen) {
        try { await elem.requestFullscreen({ navigationUI: 'hide' }); } catch {}
      } else if (document.exitFullscreen) {
        try { await document.exitFullscreen(); } catch {}
      }
    });

    // Share helper (long-press to copy URL with text)
    // Construct a sharable URL keeping current host/path
    function makeShareURL(text) {
      const base = location.origin + location.pathname;
      return base + '?text=' + encodeURIComponent(text);
    }
    // Expose for console use
    window.makeShareURL = makeShareURL;
  </script>
</body>
</html>


